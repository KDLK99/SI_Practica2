<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estadísticas</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <div class="container">
        <h1>Estadísticas</h1>
        
        <br>
        <div class="tabs">
            <button class="tab-button" onclick="showTable('clientes')">Clientes</button>
            <button class="tab-button" onclick="showTable('incidencias')">incidencias</button>
        </div>
        <br>

        <form id="clientes_form" action="/estadisticas" method="GET">
            <div class="form-group">
                <label for="nClientes">Número de clientes a mostrar:</label>
                <input type="number" id="nClientes" name="nClientes" class="form-control" min="0" required>
            </div>
            <button type="submit" class="btn btn-primary">Enviar</button>
        </form>

        <form id="incidencias_form" action="/estadisticas" method="GET">
            <div class="form-group">
                <label for="nIncidentes">Número de incidencias a mostrar:</label>
                <input type="number" id="nIncidentes" name="nIncidentes" class="form-control" min="0" required>
            </div>
            <button type="submit" class="btn btn-primary">Enviar</button>
        </form>

        <div id="clientes_graf" class="table-container">
            <h2>Top {{ x }} clientes con más incidencias reportadas</h2>
            {% if graph1 %}
                <div id='chart1' class='chart'”></div>
                    <script src='https://cdn.plot.ly/plotly-latest.min.js'></script>
                    <script type='text/javascript'>
                    var graphs = {{ graph1|safe }};
                    Plotly.plot('chart1',graphs,{});
                </script>
            {% endif %}
        </div>

        <div id="empleados_bot" class="tabs">
            <button class="tab-button" onclick="showEmpleados('clientes')">Mostrar empleados</button>
        </div>

        <div id="empleados_graf" class="table-container">
            <h2>Top 5 empleados que más tiempo han empleado en resolución de incidentes</h2>
                <div id='chart3' class='chart'”></div>
                    <script src='https://cdn.plot.ly/plotly-latest.min.js'></script>
                    <script type='text/javascript'>
                    var graphs = {{ graph3|safe }};
                    Plotly.plot('chart3',graphs,{});
                </script>
        </div>

        <div id="incidencias_graf" class="table-container" style="display: none;">
            <h2>Top {{ y }} tipos de incidencia con mayor tiempo de resolución</h2>
            {% if graph2 %}
                <div id='chart2' class='chart'”></div>
                    <script src='https://cdn.plot.ly/plotly-latest.min.js'></script>
                    <script type='text/javascript'>
                    var graphs = {{ graph2|safe }};
                    Plotly.plot('chart2',graphs,{});
                </script>
            {% endif %}
        </div>
    </div>

        <nav>
            <a href="dashboard" class="tab-button">Dashboard</a>
        </nav>

    <script>
        function showEmpleados(tableId) {
            const state = document.getElementById('empleados_graf').style.display;

            if (tableId == 'clientes') {
                document.getElementById('empleados_bot').style.display = 'block';
            }
            
            if (state == 'none' && tableId == 'clientes' && document.getElementById('clientes_form').style.display == 'block') {
                document.getElementById('empleados_graf').style.display = 'block';
            }
            else{
                document.getElementById('empleados_graf').style.display = 'none';
            }
        }

        function showTable(tableId) {
            // Ocultar todas las tablas
            document.getElementById('clientes_form').style.display = 'none';
            document.getElementById('clientes_graf').style.display = 'none';
            document.getElementById('incidencias_form').style.display = 'none';
            document.getElementById('incidencias_graf').style.display = 'none';
            document.getElementById('empleados_bot').style.display = 'none';
            showEmpleados(tableId)

            // Mostrar la tabla seleccionada
            document.getElementById(tableId+'_form').style.display = 'block';
            document.getElementById(tableId+'_graf').style.display = 'block';

            //Guardar el último elemento mostrado
            localStorage.setItem('lastShownTable', tableId);
        }
        const lastShownTable = localStorage.getItem('lastShownTable');
        if (lastShownTable) {
            showTable(lastShownTable);
        } else {
            // Si no hay un elemento guardado mostramos clientes
            showTable('None');
        }
    </script>
</body>
</html>
